# RotaPuzzle 计分系统

## 1. 基础计分规则

每个关卡的基础分计算公式保持不变:
基础分 = 碎片数量 × 目标旋转次数 × 难度系数

然而,我们将对难度系数的计算进行调整,以实现更动态和有机的难度系统:

难度系数计算:
- 初级: base_difficulty = 15 + (关卡数 - 1) * 3
- 中级: base_difficulty = 20 + (关卡数 - 1) * 4
- 高级: base_difficulty = 25 + (关卡数 - 1) * 5

碎片复杂度系数:
- 初级(规则几何图形): shape_complexity = 1.0
- 中级(不规则多边形): shape_complexity = 1.2
- 高级(包含曲线的不规则图形): shape_complexity = 1.5

非线性增长因子:
growth_factor = Math.log(关卡数 + 1) / Math.log(2)

最终难度系数:
difficulty_coefficient = base_difficulty * shape_complexity * growth_factor

## 2. 实际得分计算

- 如果实际旋转次数小于等于目标次数，玩家获得最高分数（即基础分）
- 如果超出目标次数，按比例减少得分：
  实际得分 = 基础分 × (目标旋转次数 ÷ 实际旋转次数)

## 3. 提示系统对分数的影响

- 每使用一次提示，当前关卡总分扣除100分
- 扣分后的得分不会低于0分
- 在使用提示后实时更新显示的当前得分

## 4. 关卡完成奖励

每个关卡完成后，玩家可以获得额外的旋转次数奖励：
- 旋转次数等于关卡设定次数获得1000分
- 每增加1次旋转，奖励分数减少100分，直至0分

## 5. 总分计算

游戏的总分是所有已完成关卡的实际得分之和，包括：
- 每个关卡的基础得分（考虑实际旋转次数）
- 减去每个关卡中使用提示的扣分
- 加上每个关卡的旋转次数奖励

## 6. 难度设置对分数的影响

游戏难度（初级、中级、高级）直接影响难度系数的计算，从而影响每个关卡的基础分。难度越高，获得的分数也越高，但完成拼图的难度也相应增加。

## 7. 关卡数量对分数的影响

玩家可以在游戏设置中选择4-20个关卡。关卡数量越多，可获得的总分上限就越高，同时难度系数也会随着关卡数的增加而提高。

## 8. 分数显示

- 在每个关卡和游戏结束时更新显示累积得分
- 游戏完成界面显示：
  - 本次游戏总得分
  - 本次游戏使用的难度（如：初级）
  - 游戏历史得分前5排行榜单（名次、得分、难度、时间）
    - 如果本次得分在前五，分数红色加粗显示
    - 时间如果是今天，显示Today; 如果不是今天，按2024-09-18格式显示日期

## 9. 存储与排行榜

- 使用本地存储（localStorage）保存游戏分数
- 维护一个包含前5高分的排行榜
- 在游戏结束后更新排行榜，并将新分数插入适当位置

## 10. 计分系统验证实例

为了验证更新后的计分系统的合理性，我们来看几个具体的例子：

### 例1：初级难度，第1关

假设第1关，6块碎片，目标旋转次数为5次：
- 难度系数 = 15 + (1 - 1) * 3 = 15
- 基础分 = 6 × 5 × 15 = 450分
- 玩家实际用了5次旋转完成
- 实际得分 = 450分
- 旋转次数奖励 = 1000分
- 总分 = 450 + 1000 = 1450分

### 例2：中级难度，第5关

假设第5关，8块碎片，目标旋转次数为8次：
- 难度系数 = 20 + (5 - 1) * 4 = 36
- 基础分 = 8 × 8 × 36 = 2304分
- 玩家实际用了10次旋转完成
- 实际得分 = 2304 × (8 ÷ 10) = 1843分
- 旋转次数奖励 = 1000 - (10 - 8) * 100 = 800分
- 总分 = 1843 + 800 = 2643分

### 例3：高级难度，第10关

假设第10关，12块碎片，目标旋转次数为12次：
- 难度系数 = 25 + (10 - 1) * 5 = 70
- 基础分 = 12 × 12 × 70 = 10080分
- 玩家实际用了15次旋转完成，使用了2次提示
- 实际得分 = 10080 × (12 ÷ 15) = 8064分
- 提示扣分 = 2 × 100 = 200分
- 旋转次数奖励 = 1000 - (15 - 12) * 100 = 700分
- 总分 = 8064 - 200 + 700 = 8564分

这些例子展示了更新后的计分系统如何根据难度级别和关卡数动态调整难度系数，从而影响最终得分。系统仍然鼓励玩家在目标次数内完成拼图，同时也为更高难度的关卡提供了更高的得分潜力。

## 11. 未来版本计划：计时模式

在未来的版本中，我们计划引入计时模式作为新的难度挑战。这将为游戏增加新的维度和策略考量。以下是一些初步的想法：

### 11.1 限时挑战模式
- 玩家需要在固定时间内完成拼图
- 剩余时间会影响最终得分
- 可能的计分公式：最终得分 = 基础得分 × (1 + 剩余时间百分比)

### 11.2 速度模式
- 记录玩家完成拼图的时间
- 时间越短，获得的分数越高
- 可能的计分公式：速度分数 = 基础分数 × (基准时间 ÷ 实际用时)

### 11.3 计时模式对现有计分系统的影响
- 考虑将时间因素整合到现有的计分公式中
- 可能需要重新平衡旋转次数和完成时间的权重

### 11.4 排行榜更新
- 为计时模式添加单独的排行榜
- 显示最快完成时间和最高分数

这些新模式的具体实现细节和计分方式需要在后续版本中进行深入讨论和测试，以确保它们能够很好地融入现有的游戏机制，并为玩家提供有趣且富有挑战性的体验。

## 11. 动态难度调整 (DDA)

为了进一步优化玩家体验,我们将引入一个轻量级的动态难度调整系统:

1. 如果玩家连续快速完成关卡(比如,连续3关都在目标旋转次数内完成),略微增加难度系数(增加5%)。
2. 如果玩家在某个关卡花费时间过长(比如,尝试次数超过平均值的2倍),略微降低难度系数(减少5%)。
3. 这些调整是临时的,不会累积,每个新关卡开始时都会重置。
4.动态难度调整(DDA)实例:
假设玩家在中级难度连续3关都在目标旋转次数内完成，系统会将难度系数从1.2提升到1.26 (增加5%)。这种微小的调整能够为熟练玩家提供更大的挑战，同时不会让游戏变得过于困难。


## 12. 有机难度设计

除了数值上的难度调整,我们还将引入一些有机难度设计元素:

1. 逐步引入新的碎片形状和旋转机制,确保玩家有足够时间适应新元素。
2. 在关键难度提升点之前,设置一个"缓冲"关卡,让玩家做好心理准备。
3. 使用视觉和音频提示来暗示难度的变化,比如在高难度关卡使用更紧张的背景音乐。
4.有机难度设计实例:
在第5关引入一种新的不规则多边形碎片，但只使用2-3块，让玩家有时间适应。在第6关增加到4-5块，第7关则全面使用这种新碎片。这种渐进式的难度提升能让玩家感受到挑战，但不会感到沮丧

## 13. 玩家反馈系统

为了更好地调整难度,我们将实现一个简单的玩家反馈系统:

1. 每完成5个关卡,询问玩家对难度的感受(太简单/适中/太难)。
2. 根据玩家反馈,微调难度系数(±2%)。
3. 这些调整将影响后续关卡,但不会改变当前难度模式的基本参数。
4.玩家反馈系统实例:
玩家完成第5关后，游戏询问对难度的感受。如果玩家选择"太简单"，系统会将后续关卡的难度系数微调增加2%。这种调整小到不会显著改变游戏体验，但能让玩家感觉到他们的反馈被重视。
这些设计元素共同作用，可以创造一个动态的、个性化的游戏体验，既能保持游戏的挑战性，又能适应不同玩家的技能水平。通过结合数值调整和设计元素，我们可以为玩家提供一个既有挑战又不失趣味的游戏环境[^3]。

[^3]: https://www.gamedev.net/tutorials/game-design/game-design-and-theory/game-design-a-different-approach-to-difficulty-r4992/


通过这些修改,我们的计分和难度系统将更加灵活和动态,能够更好地适应不同玩家的技能水平和游戏风格,同时保持游戏的挑战性和趣味性。

## 关于计分系统设计思考

1. 引入了更复杂的难度系数计算方法,考虑了碎片复杂度和非线性增长[^1]。
2. 添加了轻量级的动态难度调整(DDA)系统,但避免了过度干预玩家体验[^1]。
3. 引入了有机难度设计元素,使难度变化更自然,更容易被玩家接受[^2]。
4. 增加了玩家反馈系统,让玩家参与到难度调整过程中,增强游戏的互动性[^2]。

这些变化旨在创造一个更加动态和个性化的游戏体验,同时保持游戏的核心挑战性。通过结合数值调整和设计元素,我们可以为不同技能水平的玩家提供一个既有挑战又不失趣味的游戏环境。

[^1]: https://www.gamedev.net/tutorials/game-design/game-design-and-theory/game-design-a-different-approach-to-difficulty-r4992/

[^2]: https://www.gamedev.net/articles/game-design/game-design-and-theory/difficulty-in-dexterity-based-platform-games-r2055/